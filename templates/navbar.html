{% load static %}

<nav class="fixed top-0 left-0 w-full bg-[#1A1A1A] border-b border-gray-700 shadow-md z-50 transition-shadow duration-300">
  <div class="w-full px-6 flex items-center justify-between h-16">

    <!-- ✅ Left: Logo (Home Button) -->
    <div class="flex items-center">
      <a href="/" class="flex items-center space-x-2 hover:opacity-80 transition-opacity">
        <img src="{% static 'image/navbar_logo.png' %}" 
              alt="Naik Logo"
              class="h-6 sm:h-7 md:h-8 lg:h-9 xl:h-10 w-auto max-h-12 object-contain transition-transform duration-300 hover:scale-105"
              style="max-width: 80px;">
      </a>
    </div>

    <!-- ✅ Center: Navigation (Hidden on mobile) -->
    <div class="hidden md:flex items-center space-x-8">
      <a href="{% url 'search:search_products' %}" class="text-gray-300 hover:text-gray-100 font-medium transition-colors">Search Product</a>
      <a href="/" class="text-gray-300 hover:text-gray-100 font-medium transition-colors">Auction</a>
      <a href="/" class="text-gray-300 hover:text-gray-100 font-medium transition-colors">Chat</a>
      {% if user.profile.role == 'seller' or user.profile.role == 'admin' %}
        <a href="{% url 'main:create_product' %}" class="text-gray-300 hover:text-gray-100 font-medium transition-colors">Create Product</a>
      {% elif user.profile.role == 'buyer' %}
        <a href="{% url 'checkout:order_list' %}" class="block text-gray-300 hover:text-white font-medium transition-colors">View Order List</a>
      {% endif %}
    </div>

    <!-- ✅ Right: User Info + Logout (Hidden on mobile) -->
    <div class="hidden md:flex items-center space-x-6">
      {% if user.is_authenticated %}
        <!-- Profile Button (Modal Trigger) -->
        <a href="#" id="profileButton" class="flex items-center space-x-3 cursor-pointer group">
          <img src="{% static 'image/profile-icon.png' %}" 
               alt="Profile Icon" 
               class="w-8 h-8 rounded-full object-cover border border-gray-500 group-hover:border-gray-300 transition">
          <div class="text-right">
            <div class="text-sm font-medium text-gray-300 group-hover:text-gray-100">{{ user.username }}</div>
            <div class="text-xs text-gray-500 capitalize">{{ user.profile.role }}</div>
          </div>
        </a>

        <a href="{% url 'main:logout' %}" class="text-red-500 hover:text-red-600 font-medium transition-colors">
          Logout
        </a>
      {% else %}
        <a href="{% url 'main:login' %}" class="text-gray-300 hover:text-gray-100 font-medium transition-colors">Login</a>
        <a href="{% url 'main:register' %}" class="bg-gray-100 hover:bg-gray-200 text-gray-900 px-4 py-2 rounded font-medium transition-colors">
          Register
        </a>
      {% endif %}
    </div>

    <!-- ✅ Mobile Menu Button -->
    <div class="md:hidden flex items-center">
      <button id="mobileMenuButton" class="p-2 text-gray-300 hover:text-white transition">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M4 6h16M4 12h16M4 18h16" />
        </svg>
      </button>
    </div>
  </div>

  <!-- ✅ Mobile Menu Dropdown -->
  <div id="mobileMenu" class="hidden bg-[#1A1A1A] border-t border-gray-700">
    <div class="px-6 py-4 space-y-4">
      <a href="{% url 'search:search_products' %}" class="block text-gray-300 hover:text-white font-medium transition-colors">Search Product</a>
      <a href="/" class="block text-gray-300 hover:text-white font-medium transition-colors">Auction</a>
      <a href="/" class="block text-gray-300 hover:text-white font-medium transition-colors">Chat</a>
      {% if user.profile.role == 'seller' or user.profile.role == 'admin' %}
        <a href="{% url 'main:create_product' %}" class="block text-gray-300 hover:text-white font-medium transition-colors">Create Product</a>
      {% elif user.profile.role == 'buyer' %}
        <a href="{% url 'checkout:order_list' %}" class="block text-gray-300 hover:text-white font-medium transition-colors">View Order List</a>
      {% endif %}

      <hr class="border-gray-700">

      {% if user.is_authenticated %}
        <a href="#" id="profileButtonMobile" class="flex items-center space-x-3 cursor-pointer">
          <img src="{% static 'image/profile-icon.png' %}" 
               alt="Profile Icon" 
               class="w-8 h-8 rounded-full object-cover border border-gray-500">
          <div>
            <div class="text-sm font-medium text-gray-300">{{ user.username }}</div>
            <div class="text-xs text-gray-500 capitalize">{{ user.profile.role }}</div>
          </div>
        </a>
        <a href="{% url 'main:logout' %}" class="block text-red-500 hover:text-red-600 font-medium transition-colors">Logout</a>
      {% else %}
        <a href="{% url 'main:login' %}" class="block text-gray-300 hover:text-white font-medium transition-colors">Login</a>
        <a href="{% url 'main:register' %}" class="block bg-gray-100 hover:bg-gray-200 text-gray-900 px-4 py-2 rounded font-medium text-center transition-colors">Register</a>
      {% endif %}
    </div>
  </div>

  <!-- ✅ Profile Modal (Shared for both desktop & mobile) -->
  <div id="profileModal" 
       class="fixed inset-0 bg-black bg-opacity-50 hidden justify-center items-center z-50 transition-opacity duration-300">
    <div class="bg-[#1F1F1F] text-gray-200 rounded-xl shadow-lg p-8 w-full max-w-sm relative transform transition-transform scale-95">
      <button id="closeProfileModal" class="absolute top-3 right-3 text-gray-400 hover:text-white transition">✕</button>
      <img src="{% static 'image/profile-icon.png' %}" 
           alt="Profile Icon" 
           class="w-24 h-24 rounded-full object-cover mx-auto mb-4 border border-gray-600 shadow-md">
      <h2 class="text-2xl font-semibold text-center mb-1">{{ user.username }}</h2>
      <p class="text-gray-400 text-center mb-6 capitalize">{{ user.profile.role }}</p>
      <div class="text-center">
        <a href="{% url 'main:logout' %}" class="inline-block bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-md font-medium transition">
          Logout
        </a>
      </div>
    </div>
  </div>

  <!-- ✅ JavaScript -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const mobileBtn = document.querySelector("#mobileMenuButton");
      const mobileMenu = document.querySelector("#mobileMenu");
      const profileModal = document.querySelector("#profileModal");
      const profileBtn = document.querySelector("#profileButton");
      const profileBtnMobile = document.querySelector("#profileButtonMobile");
      const closeBtn = document.querySelector("#closeProfileModal");

      // Mobile Menu Toggle
      mobileBtn.addEventListener("click", () => {
        mobileMenu.classList.toggle("hidden");
      });

      // Open Profile Modal (Desktop + Mobile)
      const openModal = () => {
        profileModal.classList.remove("hidden");
        setTimeout(() => profileModal.classList.add("flex"), 10);
      };

      profileBtn?.addEventListener("click", (e) => { e.preventDefault(); openModal(); });
      profileBtnMobile?.addEventListener("click", (e) => { e.preventDefault(); openModal(); });

      // Close Profile Modal
      const closeModal = () => {
        profileModal.classList.remove("flex");
        setTimeout(() => profileModal.classList.add("hidden"), 200);
      };

      closeBtn.addEventListener("click", closeModal);
      profileModal.addEventListener("click", (e) => {
        if (e.target === profileModal) closeModal();
      });
    });
  </script>
</nav>
